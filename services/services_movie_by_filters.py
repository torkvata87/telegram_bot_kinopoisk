import re
from datetime import datetime
from typing import Any, List, Dict, Tuple

from telebot.types import InlineKeyboardMarkup

from keyboards.buttons.btns_for_movie_by_filters import (
    btns_movies_type,
    buttons_sort_type,
    buttons_genres,
    buttons_countries,
    buttons_sorting,
    buttons_re_entry_year,
)
from keyboards.inline.inline_keyboard import create_inline_keyboard
from keyboards.inline.inline_movie_by_filters import (
    select_type_keyboard,
    select_genres_keyboard,
    select_countries_keyboard,
    select_rating_keyboard,
)
from services.services_logging import error_logger_func
from states.search_fields import SearchStates


def data_filters(filters: str) -> Tuple[SearchStates, str, InlineKeyboardMarkup]:
    """
    –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `key_filters`, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É,
    —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.

    Args:
        filters (str): –ö–ª—é—á —Ñ–∏–ª—å—Ç—Ä–∞, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π, –∫–∞–∫–æ–π —Ñ–∏–ª—å—Ç—Ä –≤—ã–±—Ä–∞—Ç—å.
           –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
           - "type_filter": –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
           - "genre_filter": –§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä–∞–º.
           - "country_filter": –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–∞–º.
           - "year_filter": –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É.
           - "rating_filter": –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É.
           - "sort_filter": –§–∏–ª—å—Ç—Ä –ø–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.

    Returns:
        Tuple[SearchStates, str, InlineKeyboardMarkup]:
            - SearchStates: –°–æ—Å—Ç–æ—è–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.
            - str: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ —Ñ–∏–ª—å—Ç—Ä–µ.
            - InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞.
    """
    keyboard_type = select_type_keyboard(btns_movies_type, buttons_per_row=3)
    keyboard_genres = select_genres_keyboard(buttons_genres, buttons_per_row=4)
    keyboard_country = select_countries_keyboard(
        buttons_countries, buttons_per_row=3, include_other_option=True
    )
    keyboard_year = create_inline_keyboard(buttons_re_entry_year, buttons_per_row=1)
    keyboard_rating = select_rating_keyboard()
    keyboard_sort = create_inline_keyboard(buttons_sorting, buttons_per_row=1)

    text_type = "‚úîÔ∏è –ó–∞–¥–∞–π—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ <b><i>—Ç–∏–ø–æ–≤</i></b> —Ñ–∏–ª—å–º–∞."
    text_genres = (
        "‚úîÔ∏è –ó–∞–¥–∞–π—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ <b><i>–∂–∞–Ω—Ä–æ–≤</i></b>.\n\n"
        "–î–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–∫–Ω–∏—Ç–µ <b>"
        '<i>"‚ùå –ò—Å–∫–ª—é—á–∏—Ç—å"</i></b> –ø–µ—Ä–µ–¥ –∫–ª–∏–∫–æ–º –Ω–∞ –∏—Å–∫–ª—é—á–∞–µ–º—ã–π –∂–∞–Ω—Ä.'
    )
    text_country = "‚úîÔ∏è –ó–∞–¥–∞–π—Ç–µ <b><i>—Å—Ç—Ä–∞–Ω—É</i></b>."
    text_year = (
        '‚úçÔ∏è –í–≤–µ–¥–∏—Ç–µ <b><i>–≥–æ–¥</i></b> –≤ —Å—Ç—Ä–æ–∫—É –≤–≤–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <b>"–ì–ì–ì–ì"</b> '
        '–∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º <b>"–ì–ì–ì–ì-–ì–ì–ì–ì"</b>.'
    )
    text_rating = (
        "‚úîÔ∏è –ó–∞–¥–∞–π—Ç–µ <b><i>—Ä–µ–π—Ç–∏–Ω–≥</i></b> –∏–ª–∏ –µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–≤—É–º—è –∫–ª–∏–∫–∞–º–∏.\n\n"
        '–ü—Ä–∏–º–µ—Ä: <i>"7"</i>, <i>"7-10"</i>'
    )
    text_sort = "‚úîÔ∏è –ó–∞–¥–∞–π—Ç–µ <b><i>—Ñ–∏–ª—å—Ç—Ä—ã</i></b> –¥–ª—è <b><i>—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</i></b>."

    dict_state = {
        "type_filter": SearchStates.type,
        "genre_filter": SearchStates.genres,
        "country_filter": SearchStates.countries,
        "year_filter": SearchStates.year,
        "rating_filter": SearchStates.rating,
        "sort_filter": SearchStates.sorting,
    }

    dict_text = {
        "type_filter": text_type,
        "genre_filter": text_genres,
        "country_filter": text_country,
        "year_filter": text_year,
        "rating_filter": text_rating,
        "sort_filter": text_sort,
    }

    dict_keyboard = {
        "type_filter": keyboard_type,
        "genre_filter": keyboard_genres,
        "country_filter": keyboard_country,
        "year_filter": keyboard_year,
        "rating_filter": keyboard_rating,
        "sort_filter": keyboard_sort,
    }

    return dict_state[filters], dict_text[filters], dict_keyboard[filters]


@error_logger_func
def set_letter(list_parameters: List[str], letter: str = "–∞") -> str:
    """
    –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç
    –¥–ª—è —Å–ª–æ–≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–ª–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ.

    Args:
        list_parameters (List): –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
        letter (str): –ë—É–∫–≤–∞ –∏–ª–∏ —Å–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ü–µ —Å–ª–æ–≤–∞ –≤ –µ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º —á–∏—Å–ª–µ.
            –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é "–∞".

    Returns:
        str: –ë—É–∫–≤–∞ –∏–ª–∏ —Å–∏–º–≤–æ–ª –Ω–∞ –∫–æ–Ω—Ü–µ —Å–ª–æ–≤–∞, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

    Raises:
        ValueError: –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π`list_parameters`.
    """
    if not isinstance(list_parameters, list):
        raise ValueError("`list_parameters` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–∏—Å–∫–æ–º.")
    return letter if len(list_parameters) == 1 else "—ã"


@error_logger_func
def format_genres_list(raw_list_genres: List[str]) -> List[str]:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∂–∞–Ω—Ä–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
    –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

    –î–µ–π—Å—Ç–≤–∏—è:
        1. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ –≤ —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ", ".
        2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
           - –ó–∞–º–µ–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ "!, +" –Ω–∞ "!, ".
           - –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–∏ "!, !" –Ω–∞ "!, ", –∏—Å–∫–ª—é—á–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥—É—â–∏—Ö –ø–æ–¥—Ä—è–¥ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
           –∂–∞–Ω—Ä–∞ –Ω–∞ –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª "!".
           - –ó–∞–º–µ–Ω—è–µ—Ç "18+" –Ω–∞ "–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö".
           - –ó–∞–º–µ–Ω—è–µ—Ç "–¥/—Ñ" –Ω–∞ "–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π".
        3. –£–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω—é—é –∑–∞–ø—è—Ç—É—é –∏ –ø—Ä–æ–±–µ–ª –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
        4. –î–µ–ª–∏—Ç —Å—Ç—Ä–æ–∫—É –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é ", " –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤.

    Args:
        raw_list_genres (List[str]): –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

    Returns:
        List[str]: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

    Raises:
        ValueError: –ï—Å–ª–∏ `raw_list_genres` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–∫–æ–º —Å—Ç—Ä–æ–∫.
    """
    if not isinstance(raw_list_genres, list) or not all(
        isinstance(i, str) for i in raw_list_genres
    ):
        raise ValueError("–û—à–∏–±–∫–∞: –û–∂–∏–¥–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.")

    string = ", ".join(raw_list_genres)
    string = re.sub(pattern=r"(!,\s*)+", repl="!, ", string=string)
    string = re.sub(pattern=r"(!,\s!)", repl="!, ", string=string)
    string = re.sub(pattern=r"!,\s\+", repl="!", string=string)
    string = re.sub(pattern=r"18\+", repl="–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö", string=string)
    string = re.sub(pattern=r"–¥/—Ñ", repl="–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π", string=string)

    if string.endswith(", !, "):
        string = string[:-5]

    return string.split(", ")


@error_logger_func
def format_genres_string(genres: List[str], for_database: bool = False) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –≤ —Å—Ç—Ä–æ–∫—É —Å —É—á–µ—Ç–æ–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∂–∞–Ω—Ä–æ–≤.

    –î–µ–π—Å—Ç–≤–∏—è:
        1. –†–∞–∑–¥–µ–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –Ω–∞ —Å–ø–∏—Å–∫–∏ –∂–∞–Ω—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ
        –∑–∞–ø—Ä–æ—Å–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º "+" –∏ "!".
        2. –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Ç–æ –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è —ç–º–æ–¥–∑–∏ "‚úîÔ∏è",
        –∞ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ ‚Äî "‚úñÔ∏è". –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —Å—Ç—Ä–æ–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

    Args:
        genres (List[str]): –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ "+" –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∏ "!" –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è.
        for_database (bool): –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –Ω—É–∂–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é False.

    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∂–∞–Ω—Ä–æ–≤.

    Raises:
        ValueError: –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤.

    Examples:
        –í—Ö–æ–¥–Ω–æ–π —Å–ø–∏—Å–æ–∫: ["+–∫–æ–º–µ–¥–∏—è", "!–∫—Ä–∏–º–∏–Ω–∞–ª", "!–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö", "+–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π"].
        –°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–ñ–∞–Ω—Ä—ã: –∫–æ–º–µ–¥–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –∏—Å–∫–ª—é—á–µ–Ω—ã –∫—Ä–∏–º–∏–Ω–∞–ª, –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö".
        –°—Ç—Ä–æ–∫–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: "‚úîÔ∏è –∫–æ–º–µ–¥–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, ‚úñÔ∏è –∫—Ä–∏–º–∏–Ω–∞–ª, –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö"
    """
    if not genres or not isinstance(genres, list):
        raise ValueError("–°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º —Å—Ç—Ä–æ–∫.")

    included_genres = [genre.lstrip("+") for genre in genres if genre.startswith("+")]
    excluded_genres = [genre.lstrip("!") for genre in genres if genre.startswith("!")]

    if for_database:
        included_str = "‚úîÔ∏è " + ", ".join(included_genres) if included_genres else ""
        excluded_str = "‚úñÔ∏è " + ", ".join(excluded_genres) if excluded_genres else ""
        explanation = ""
        separator = ", "
    else:
        colon_1 = "" if not included_genres else ":"
        colon_2 = "" if included_genres else ":"
        letter = (
            ""
            if (not included_genres and len(excluded_genres) == 1)
            or (len(included_genres) == 1 and not excluded_genres)
            else "—ã"
        )

        explanation = f"<b>–ñ–∞–Ω—Ä{letter}{colon_1}</b> "

        included_str = ", ".join(included_genres)
        excluded_str = (
            f"<b>–∏—Å–∫–ª—é—á–µ–Ω{set_letter(excluded_genres, letter='')}{colon_2} </b>{', '.join(excluded_genres)}"
            if excluded_genres
            else ""
        )
        separator = "\n"

    if included_str and excluded_str:
        return f"{explanation}{included_str}{separator}{excluded_str}"
    elif included_str:
        return f"{explanation}{included_str}"
    else:
        return f"{explanation}{excluded_str}"


@error_logger_func
def is_valid_year(message: Any) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–æ–¥–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –≥–æ–¥–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 1920 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞.

    –î–µ–π—Å—Ç–≤–∏—è:
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–¥–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–±–æ–π –æ–¥–∏–Ω –≥–æ–¥
        –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤.
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∏—Å–ª–∞–º–∏.
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ª–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–π –≥–æ–¥ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤ –¥–æ–ª–∂–µ–Ω –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 1920 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞.

    Args:
        message (Any): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç —Å –≥–æ–¥–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –≥–æ–¥–æ–≤.
            - message.text (str): –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

    Returns:
        bool: True, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≥–æ–¥—É –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É –≥–æ–¥–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 1920 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞,
            –∏–Ω–∞—á–µ False.

    Raises:
        AttributeError: –ï—Å–ª–∏ —É –æ–±—ä–µ–∫—Ç–∞ `message` –Ω–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–∞ `text`.

    Examples:
        - "1995" –≤–µ—Ä–Ω–µ—Ç True.
        - "2000-2010" –≤–µ—Ä–Ω–µ—Ç True.
        - "1919" –≤–µ—Ä–Ω–µ—Ç False.
        - "2025" –≤–µ—Ä–Ω–µ—Ç False, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –≥–æ–¥ ‚Äî 2024.
    """
    current_year = datetime.now().year

    if not hasattr(message, "text"):
        raise AttributeError("–û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç 'text'.")

    text = message.text.strip().strip("-").split("-")

    if len(text) > 2:
        return False
    for elem in text:
        if not elem.isdigit():
            return False
        year = int(elem)
        return 1920 <= year <= current_year

    return False


@error_logger_func
def normalize_year_range(year_input: str) -> str:
    """
    –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–π –≥–æ–¥ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

    –î–µ–π—Å—Ç–≤–∏—è:
        - –†–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ —Å–∏–º–≤–æ–ª—É "-" –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥–æ–¥—ã, –µ—Å–ª–∏ —ç—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω.
        - –ï—Å–ª–∏ –≤–≤–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –æ–¥–∏–Ω –≥–æ–¥ –∏–ª–∏ –æ–±–∞ –≥–æ–¥–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ä–∞–≤–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –≥–æ–¥.
        - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç, —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞—è –∏—Ö –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é.

    Args:
        year_input (str): –°—Ç—Ä–æ–∫–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –≥–æ–¥ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤.

    Returns:
        str: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω, –≥–¥–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ –≤—Ç–æ—Ä–æ–≥–æ.

    Raises:
        ValueError: –ï—Å–ª–∏ –≤—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≥–æ–¥–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –≥–æ–¥–æ–≤.

    Examples:
        - "1995" –≤–µ—Ä–Ω–µ—Ç "1995".
        - "2010-2010" –≤–µ—Ä–Ω–µ—Ç "2010".
        - "2025-2023" –≤–µ—Ä–Ω–µ—Ç "2023-2025".
    """
    year_list = year_input.split("-")

    if len(year_list) > 2 or not all(y.isdigit() for y in year_list):
        raise ValueError("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≥–æ–¥–∞ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≥–æ–¥–æ–≤.")

    if len(year_list) == 1 or year_list[0] == year_list[1]:
        return str(year_list[0])
    return f"{min(year_list)}-{max(year_list)}"


@error_logger_func
def generate_filter_parameters(
    filter_data: Dict[str, Any], for_search: bool = False
) -> Dict[str, Any]:
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

    –î–µ–π—Å—Ç–≤–∏—è:
        - –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `for_search` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `True`, —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–ø–∏—Å–∫–∏ –∂–∞–Ω—Ä–æ–≤ –∏ —Ç–∏–ø–æ–≤ –≤ –∫–æ—Ä—Ç–µ–∂–∏,
          –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Å–∫–ª—é—á–∞–µ–º—ã–µ –∂–∞–Ω—Ä—ã (`–∫–æ–Ω—Ü–µ—Ä—Ç`, `—Ü–µ—Ä–µ–º–æ–Ω–∏—è`, `—Ç–æ–∫-—à–æ—É`).
        - –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫ –∏ —Å–ø–∏—Å–∫–æ–≤.

    Args:
        filter_data (Dict[str, Any]): –°–ª–æ–≤–∞—Ä—å —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –≤–∫–ª—é—á–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
            - `genres`: –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é [`+–¥—Ä–∞–º–∞`]).
            - `type`: –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ —Ñ–∏–ª—å–º–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é [`movie`, `tv-series`]).
            - `rating`: –†–µ–π—Ç–∏–Ω–≥ —Ñ–∏–ª—å–º–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `7-10`).
            - `type_sort`: –¢–∏–ø —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `rating.kp`).
            - `sort`: –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `-1`).
            - `year`: –ì–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é None).
            - `countries`: –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é None).
        for_search (bool): –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –¥–æ–ª–∂–µ–Ω –ª–∏ –±—ã—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–æ–∏—Å–∫–∞, —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
                          —Å–ø–∏—Å–∫–æ–≤ –≤ –∫–æ—Ä—Ç–µ–∂–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö –∂–∞–Ω—Ä–æ–≤. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é False.

    Returns:
        Dict[str, Any]: –°–ª–æ–≤–∞—Ä—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
            - `type`: –¢–∏–ø—ã —Ñ–∏–ª—å–º–æ–≤ (–≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –∫–æ—Ä—Ç–µ–∂–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `for_search`).
            - `genres`: –ñ–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤ (–≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –∫–æ—Ä—Ç–µ–∂–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `for_search`).
            - `rating`: –†–µ–π—Ç–∏–Ω–≥ —Ñ–∏–ª—å–º–æ–≤ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
            - `type_sort`: –¢–∏–ø —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
            - `sort`: –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
            - `year`: –ì–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ None.
            - `countries`: –°—Ç—Ä–∞–Ω—ã (–≤ –≤–∏–¥–µ –∫–æ—Ä—Ç–µ–∂–∞ –∏–ª–∏ None –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `for_search`).

    Raises:
        ValueError: –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å–ª–æ–≤–∞—Ä–µ–º.
    """
    if not isinstance(filter_data, dict):
        raise ValueError("–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è")

    genres = filter_data.get("genres", ["+–¥—Ä–∞–º–∞"])
    type_movies = filter_data.get("type", ["movie", "tv-series"])
    countries = filter_data.get("countries", None)

    if for_search:
        type_movies = tuple(type_movies)
        list_exclude = ["!–∫–æ–Ω—Ü–µ—Ä—Ç", "!—Ü–µ—Ä–µ–º–æ–Ω–∏—è", "!—Ç–æ–∫-—à–æ—É"]
        genres.extend(list_exclude)
        genres = tuple(genres)
        countries = tuple(countries) if countries else None

    return {
        "type": type_movies,
        "genres": genres,
        "rating": filter_data.get("rating", "7-10"),
        "type_sort": filter_data.get("type_sort", "rating.kp"),
        "sort": filter_data.get("sort", "-1"),
        "year": filter_data.get("year", None),
        "countries": countries,
    }


@error_logger_func
def format_filter_data(
    filter_data: Dict[str, List | str], for_database: bool = False
) -> List[Dict[str, List | str]]:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π.

    –î–µ–π—Å—Ç–≤–∏—è:
        - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∂–∞–Ω—Ä–∞–º–∏, —É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
        - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–∏–ø—ã —Ñ–∏–ª—å–º–æ–≤, —Å—Ç—Ä–∞–Ω—ã, –≥–æ–¥—ã –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π.

    Args:
        filter_data (Dict[str, List | str]): –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤.
        for_database (bool): –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –Ω—É–∂–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é False.

    Returns:
        List[Dict[str, List | str]]: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

    Raises:
        ValueError: –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å–ª–æ–≤–∞—Ä–µ–º.
    """
    if not isinstance(filter_data, dict):
        raise ValueError("–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è")

    type_movies = [btns_movies_type[elem] for elem in filter_data["type"]]
    genres = filter_data["genres"]

    genres_str = format_genres_string(genres, for_database=for_database)
    countries = (
        ", ".join(filter_data["countries"]) if filter_data["countries"] else ""
    )
    sort_num = filter_data["sort"]
    sort = "–ø–æ —É–±—ã–≤–∞–Ω–∏—é" if sort_num == "-1" else "–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é"

    text_sort = f"{buttons_sort_type[filter_data.get('type_sort')]} {sort}"

    return [
        {"üéûÔ∏è –¢–∏–ø:": ", ".join(type_movies)},
        {"üé≠ ": genres_str if genres else ""},
        {"üóìÔ∏è –ì–æ–¥:": filter_data["year"]},
        {"üåç –°—Ç—Ä–∞–Ω–∞:": countries},
        {"üèÜ –†–µ–π—Ç–∏–Ω–≥:": filter_data["rating"]},
        {"üîÉ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:": text_sort},
    ]


@error_logger_func
def format_filters_to_string(
    filters_list: List[Dict[str, List[str] | str]], for_database: bool = False
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

    –î–µ–π—Å—Ç–≤–∏—è:
        - –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–ª—é—á–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø—Ä–æ–±–µ–ª–∞–º–∏.
        - –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω—É–∂–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–ª—é—á–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ HTML-—Ç–µ–≥–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É.

    Args:
        filters_list (List[Dict[str, List[str] | str]]): –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω
            –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å.
        for_database (bool): –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —Å–ª–µ–¥—É–µ—Ç –ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é False.

    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

    Raises:
        ValueError: –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—É—Å—Ç –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

    Examples:
        - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: "üéûÔ∏è –¢–∏–ø: –∫–æ–º–µ–¥–∏—è, –¥—Ä–∞–º–∞, üé≠ –ñ–∞–Ω—Ä—ã: ‚úîÔ∏è –∫–æ–º–µ–¥–∏—è, –¥—Ä–∞–º–∞".
        - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "<b><i>üéûÔ∏è –¢–∏–ø:</i></b> –∫–æ–º–µ–¥–∏—è, –¥—Ä–∞–º–∞".
    """
    if not filters_list or not isinstance(filters_list, list):
        raise ValueError("–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º —Å–ª–æ–≤–∞—Ä–µ–π.")

    if for_database:
        return ", ".join(
            [
                f"{key[0]} {value}"
                for elem in filters_list
                for key, value in elem.items()
                if value
            ]
        )
    return "\n\n".join(
        [
            f"<b><i>{key}</i></b> <i>{value}</i>"
            for elem in filters_list
            for key, value in elem.items()
            if value
        ]
    )
